# Sessions

Este assunto tem uma extrema importância no PHP. Você vai entender como funciona a segurança de areas restritas no PHP.

Vamos implementar um controle básico de conteúdo, simulando uma area restrita, para termos uma noção de como controlar uma sessão com PHP.

Primeiramente vamos criar dois arquivos: index.php e secret.php. O index.php já está criado e pode ser o mesmo.

# Conteúdo index.php

```php
<?php
session_start();

$login = "admin";
$password = "12345";

if($login == "admin" && $password == "12345"){
    $_SESSION['login'] = true;
    echo "Success!";
}else{
    echo "Error!";
}

?>

<a href="session/secret.php">Get in</a>
```

# Conteúdo secret.php

```php
<?php
session_start();

if($_SESSION['login']){
    echo "Secret area!";
}else{
    echo "Incorrect login!";
}
//unset($_SESSION['login']);
?>
```

Agora que temos o conteúdo vamos comentar sobre ele.

# Arquivo index.php

Um detalhe importante é que não pode existir nada antes da criação da sessão. Não pode existir nenhum HTML sendo renderizado antes da função **session_start**, pois o PHP irá dar um erro.

A função `session_start()` é responsável por informar o sistema que está sendo iniciada uma sessão. Logo após inserir esta função nós criamos duas variáveis: login e password.

Depois basta que façamos um teste lógico, que já aprendemos no módulo de condicionais. Se o login e o password forem corretos o sistema irá criar uma sessão para o usuário. Criar uma sessão é muito simples e muito parecido com os cookies, que aprendemos no módulo anterior. Veja como foi criado:

```php
$_SESSION['login'] = true;
```

Imprimimos um texto **Success** caso as credenciais estejam corretas, além de criar a sessão login, para termos uma certeza visual que o sistema logou. Se caso não esteja correto login ou password, temos um erro sendo mostrado e consequentemente a variável de sessão não é criada.

A variável de sessão criada servirá para autenticar o usuário e permitir que ele tenha acesso a área restrita que iremos criar.

Depois de criada a lógica de autenticação e criação da variável de sessão, inserimos um link para acessarmos a área restrita.

# Arquivo secret.php

Neste arquivo a primeira coisa que fizemos foi iniciar a sessão, assim como no arquivo index.php. Logo depois fizemos outro teste lógico para saber se existe a sessão criada ou não. Caso exista vamos exibir a área restrita porque ele tem acesso, caso não exista é porque o login falhou então exibimos um erro.

Isso é feito porque uma pessoa pode gravar a url da área restrita e tentar acessar diretamente, mas se ele não não foi autenticado, ele não terá acesso. É para isso que serve a sessão, para garantir a segurança do sistema e só mostrar conteúdo para quem tiver acesso, caso alguém tente acessar diretamente não irá conseguir, porque não haverá sessão criada.

# Destruindo sessão

Iremos lhe mostrar como destruir uma sessão, que seria um caso de logout do sistema, por exemplo. Por que temos que fazer isso?

Faça um teste de colocar a senha errada e volte para a tela de login em seu navegador. Você verá que o usuário não foi logado e terá a mensagem de erro, mas se clicar no link da área restrita você ainda terá acesso, isso ocorre porque a variável de sessão já foi criada e ela não foi destruída.

Então temos que destruir a variável de sessão quando o usuário sai do sistema ou quando existe um erro de autenticação, podemos ver se a variável existe e se existir nós a destruimos.

Para destruir uma variável de sessão basta utilizarmos a função do PHP **unset**. A função unset serve para destruir qualquer variável, não somente variáveis de sessão.

`unset($_SESSION['login']);`

Desta maneira a sessão é destruída e o usuário precisará se autenticar novamente.

Faça alguns testes, crie um sisteminha simples de autenticação para fixar o conceito de sessões. Este assunto é realmente muito interessante e importante para programadores. Lembre-se, quase todos os sistemas precisam de uma autenticação e consequentemente precisarão do uso de sessões para conseguir controlar o acesso dos usuários.