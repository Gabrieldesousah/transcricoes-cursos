# Trabalhando com http

Neste módulo iremos aprender a utilizar a classe **http**, desta forma estaremos criando o primeiro web server utilizando Node.js.

Nós precisamos aprender algumas coisas referentes a módulos antes de continuarmos. Mais para frente iremos falar melhor sobre este assunto, por enquanto é só um conhecimento básico para que entenda o funcionamento do http.

O Node é uma plataforma que tem várias APIs por trás de seu funcionamento. Cada API é responsável para fazer alguma coisa a seu favor, então temos a de **http**, que é responsável por lidar com a internet, possuímos a de arquivo, que é responsável por lidar com tudo que envolve arquivos em seu projeto entre outras.

Trabalhando com Node nós temos tudo que qualquer outra linguagem possui, afinal o Node é uma linguagem como qualquer outra, com base em javascript. Sabendo disso nós podemos importar módulos, presentes nas APIs, de acordo com a necessidade do seu projeto.

Nós devemos utilizar o **require** seguido do nome do módulo como parâmetro. Podemos utilizar este recurso tanto para módulos nativos do Node, quanto para bibliotecas que foram gerenciadas e instaladas pelo npm.

Falaremos mais sobre gerenciamento de arquivos durante o conteúdo, sobre como montar estruturas e carregar arquivos externos, mas o foco deste módulo é informar que existe uma palavra reservada chamada require, que tem a função de requerer, como o próprio nome já diz, o arquivo ou módulo que estamos passando como argumento.

```js
var http = require('http');

function handle(request,response){
    response.end('Hello from http module');
}

var server = http.createServer(hangle);

server.listen(3000, function(){
    console.log('Server is listening as port 3000');
});
```

No código acima nós importamos o **módulo http** para a **variável http**. Depois disso criamos uma função chamada **handle** com dois parâmetros, que vocês já devem imaginar o que são. E com certeza devem estar imaginando corretamente, um é a requisição, feita pelo usuário, e o outro é a resposta que o servidor irá retornar.

Neste caso não estamos fazendo nenhuma lógica para que o servidor possa processar, estamos apenas retornando uma mensagem e finalizando o acesso ao servidor com o método **end**.

Logo depois nós criarmos um server, utilizando a função **createServer**, e passamos a função handle, como parâmetro, depois o atribuimos a uma variável chamada server. Em seguida nós utilizamos o método **listen** para habilitar a porta que o servidor receberá os dados de entrada. Passamos a porta 3000 que é um padrão mais utilizado, porém você pode informar outra porta, só tomem cuidado para não utilizar portas que o seu sistema operacional utiliza ou alguns programas, isso fará com que tenha conflitos.

Para acessar este arquivo no browser e conseguir ver o resultado dele, temos que rodar um comando no terminal capaz de executar este arquivo, somente depois disso teremos o nosso servidor rodando de verdade.

Comando: `node app.js`

Veja o resultado quando acessamos o browser no seguinte endereço: **http://localhost:3000**.

![node_server_hello](./images/node_server_hello.png "node_server_hello")

# Retornando um html como response

```js
var http = require('http');

function handle(request,response){

    response.writeHead(200,{
       'Content-Type': 'text/html'
    });

    response.write("<!DOCTYPE html>");
    response.write("<html>");
    response.write("<head><title>Http Module</title></head>");
    response.write("<body>");
    response.write("<h1>Hello from http module SON</h1>");
    response.write("</body>");
    response.write("</html>");

    response.end();
}

var server = http.createServer(handle);

server.listen(3000, function(){
    console.log('Server is listening as port 3000');
});
```

Reparem que alteramos a nossa função handle. Agora ela não retorna apenas uma mensagem simples do tipo **text/plain**, nós alteramos o Content-Type da response para **text/html**. Isso fará que o browser interprete como um html e não mais como um texto simples.

Depois de alterar o content type nós adicionamos uma estrutura básica de html utilizando o método **write** e finalizamos a response sem mensagem nenhuma desta vez. Não adicionamos mensagem porque já inserimos conteúdo à ela.

Agora basta ir ao terminal e rodar o arquivo novamente, caso não rode você não terá as alterações efetivadas: `node app.js`

![node_server_html](./images/node_server_html.png "node_server_html")

Percebam como foi fácil gerar o html no browser utilizando o módulo http do Node. Apenas alteramos o content type e depois só adicionamos os elementos com um método simples.

Através do html surgiram todos os frameworks node.js voltados para web. Os criadores do node tornaram o trabalho com http muito mais fácil, simples e dinâmico para nós utilizarmos. A prova disso é que nosso arquivo tem menos de 25 linhas e já fizemos um exemplo muito funcional.