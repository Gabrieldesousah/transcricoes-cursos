# PHP Code Sniffer

Como falamos no início desta conteúdo, o nosso objetivo é trabalhar sempre com os padrões do **PHPFIG**, então estamos prezando, a todo momento, trabalhar com a criação de um código baseado na PSR1 e PSR2.

A IDE pode nos auxiliar a seguir estes padrões, mas muitas vezes passam alguns erros despercebidos, por mais que você as configure para detectar os erros.

Por isso temos uma ferramenta, na comunidade, que analisa este código pra gente. Esta ferramente se chama **PHP_CodeSniffer**.

Vamos instalar a ferramenta e fazer uma varredura em nossa aplicação, afim de detectar erros ou alguma prática de programação fora do padrão que adotamos.

Podemos trabalhar com o CodeSniffer via composer, em nossa aplicação diretamente, ou instalando a ferramenta de forma global em nossa máquina. A vantagem de trabalhar de forma global é que podemos executar a qualquer momento e em qualquer projeto diretamente, sem precisar ficar instalando em todas as nossas aplicações.

Nós executaremos de forma global, então para instalar rode o comando abaixo:

`composer require squizlabs/php_codesniffer:* --dev`

Depois que a biblioteca é instalada ela cria dois arquivos na pasta **vendor/bin**: **phpcbf** e **phpcs**.

| Arquivo | Descrição |
| ------- | --------- |
| phpcbf  | Verifica melhorias no código e as executa automaticamente |
| phpcs   | Apenas verifica melhorias no código e nos mostra |

Para executar os arquivo e obter os erros encontrados temos que rodar um dos comandos abaixo:

`vendor/bin/phpcs ./src`

`vendor/bin/phpcs ./src/View/Twig/TwigGlobals.php`

O primeiro comando varre a pasta completa e o segundo executa um arquivo específico. Colocamos os dois exemplos para que você possa saber qual a melhor forma de executar, porque pode ser que existam muitos arquivos dentro de uma pasta e fique complicado de você visualizar todos os erros gerados. Então você pode ir executando por partes.

Existe uma forma de visualizar mais facilmente e mais resumidamente que é utilizando o parâmetro **--report=summary**.

`vendor/bin/phpcs --report=summary ./src`

Estes comando nos sugerem a utilização do comando **vendor/bin/phpcbf** para que os erros sejam corrigidos automaticamente. Então rodaremos o seguinte comando:

`vendor/bin/phpcbf ./src`

Depois de executar este comando você terá todos os seus arquivos, com erros, modificados. Um dos arquivos que você pode ver melhor a alteração é no arquivo **src/controllers/bill-pays.php**, por exemplo, mas todos os outros que tinham erros foram corrigidos para o padrão correto.

Você poderá ver uma melhoria significativa em questão de visualização do código.

Caso execute o comando novamente você verá que não existem mais erros, a serem corrigidos automaticamente, mas ainda existirão alguns a serem corrigidos manualmente.

Existirão muitos erros de ausência de documentação, mas como não estamos focando em documentá-la você pode ignorar estes erros.

Porém existem alguns erros de variáveis privadas, que o php_codesniffer sugere que iniciemos com o **underscore**, caso exista alguma variável que não iniciamos com este caractere você poderá renomear para acabar com os erros. Esta operação ficará como tarefa para vocês, caso existam.

Depois deste procedimento, temos certeza que estamos dentro do padrão correto de desenvolvimento e temos a certeza de que nosso código está muito mais legível.

Agora basta subir nossa aplicação para produção, utilizando o Keroku.