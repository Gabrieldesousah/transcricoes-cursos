# Exclusão de categorias de custo

Agora que temos a adição e a edição funcionando corretamente, vamos criar a exclusão das categorias para finalizarmos nosso CRUD completo.

Você pode criar a exclusão diretamente no botão ou criar uma página intermedária para permitir ao usuário uma análise e uma confirmação, antes de efetuar a exclusão. Existem outras formar utilizando modais, mas criaremos uma página intermediáris para confirmação.

Primeiro criaremos uma rota para encaminhar o usuário para página de confirmação de exclusão. Editaremos o arquivo **public/index.php**.

```php
->get('/category-costs/{id}/show', function(ServerRequestInterface $request) use($app){
        $view = $app->service('view.renderer');
        $id = $request->getAttribute('id');
        $category = \SONFin\Models\CategoryCost::findOrFail($id);
        return $view->render('category-costs/show.html.twig', [
            'category' => $category
        ]);
    }, 'category-costs.show')
```

Vejam que estamos buscando o id e direcionando para um template, que irá mostrar os dados da categoria, antes de fazer a exclusão. O template ainda não existe, então crie o arquivo **templates/category-costs/show.html.twig**. Veja o código do arquivo:

```html
{% extends 'layout.html.twig' %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Ver categoria de custo
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <a href="{{ route('category-costs.edit',{'id': category.id}) }}"
                               class="btn btn-primary">
                                <span class="glyphicon glyphicon-pencil"></span>
                            </a>
                            <a href="{{ route('category-costs.delete',{'id': category.id}) }}"
                               class="btn btn-danger">
                                <span class="glyphicon glyphicon-remove"></span>
                            </a>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table table-bordered">
                                <tbody>
                                <tr>
                                    <th scope="row">#</th>
                                    <td>{{ category.id }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Nome</th>
                                    <td>{{ category.name }}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
```

Desta forma estamos listando os dados, da categoria, antes de excluir, mas ainda falta criar a rota de exclusão. Portanto, no arquivo **public/index.php**, adicione a rota de exclusão abaixo:

```php
->get('/category-costs/{id}/delete', function(ServerRequestInterface $request) use($app){
        $id = $request->getAttribute('id');
        $category = \SONFin\Models\CategoryCost::findOrFail($id);
        $category->delete();
        return $app->route('category-costs.list');
    }, 'category-costs.delete');
```

Vejam que estamos fazendo praticamente a mesma coisa que a rota de edição, porém estamos utilizando o método **delete**, que se encarrega de excluir o registro do banco de dados. Depois de excluir estamos redirecionando para a página de listagem.

Está praticamente tudo pronto, basta adicionarmos o link, para a rota de exclusão, no botão de exclusão, que se encontra na página de listagem de categorias. Edite o arquvio **template/category-costs/list.html.twig**. Veja o código abaixo e altere no seu projeto:

```html
<tbody>
{% for category in categories %}
    <tr>
        <td>{{ category.id }}</td>
        <td>{{ category.name }}</td>
        <td>
            <a href="{{ route('category-costs.edit', {'id': category.id}) }}">
                <span class="glyphicon glyphicon-pencil"></span>
            </a>
            |
            <a href="{{ route('category-costs.show', {'id': category.id}) }}">
                <span class="glyphicon glyphicon-remove"></span>
            </a>
        </td>
    </tr>
{% endfor %}
</tbody>
```

Reparem que o link de remoção leva o usuário para a rota **category-costs.show**, que apenas mostra os dados da categoria, e no template show que ele efetua a exclusão efetivamente.

Desta forma estamos com o CRUD completo e podemos dar continuidade ao nosso projeto de Finanças.