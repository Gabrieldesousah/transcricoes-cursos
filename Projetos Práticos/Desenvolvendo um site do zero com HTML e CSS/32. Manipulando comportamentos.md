# Manipulando comportamentos

No módulo anterior, conseguimos efetuar o envio de email, mas observamos que após o envio somos encaminhados para uma tela com dados em JSON e visualmente muito ruim.

Neste módulo melhoraremos este procedimento manipulando o comportamento de nosso formulário, utilizando o javascript.

Utilizaremos uma biblioteca javascript que se chama jQuery. Para isso pesquise no Google **jquery cdn** para que consigamos carregar esta biblioteca em nosso site.

O site que deverá encontrar é <https://code.jquery.com>. Vamos utilizar a versão *3.2.1 - minified* para nosso projeto. Clicando no link minified você deverá copiar o código abaixo: 

```html
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
```

O código acima deverá ser colado antes do fechamento da tag **body**, em nosso footer.

```html
<div id="copyright">
    &copy; Chatschool - 2017 - Todos os direitos reservados
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</body>
</html>
```

Se você não conhece javascript, aconselhamos que leia o conteúdo sobre esta linguagem antes de começar a trabalhar com jQuery, que é uma biblioteca para javascript. A School of Net possui conteúdo para leitura.

Depois de chamar a biblioteca vamos escrever o nosso próprio script, para conseguir manipular o evento de submit do formulário. Veja o código abaixo:

```html
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $('form').submit(function (event) {
        event.preventDefault();
    });
</script>
```

O primeiro passo que fizemos foi anular o evento de submit. Desta forma, quando o usuário clica em enviar não carregaremos outra página. A princípio não será feito nada.

Quando o usuário submeter o formulário o jQuery, através do seletor pegará o evento e aplicará o método **preventDefault**, que é responsável por anular a o evento de submit.

Depois nós aproveitamos o evento e alteramos o valor do botão para **Aguarde...** e, logo em seguida, desabilitamos o botão. Veja código:

```html
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $('form').submit(function (event) {
        event.preventDefault();

        $('form input[type="submit"]').val('Aguarde...')
            .attr('disabled', true);
    });
</script>
```

Por último efetuamos o envio do email utilizando **ajax** que é uma requisição assíncrona. Desta forma não teremos o recarregamento da página.

Então fazemos o envio de email e já tratamos o resultado, ao invés de deixar que o site direcione o usuário para outra tela, como está atualmente.

```html
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    $('form').submit(function (event) {
        event.preventDefault();

        $('form input[type="submit"]').val('Aguarde...')
            .attr('disabled', true);

        $.ajax({
            type: $('form').attr('method'),
            url: $('form').attr('action'),
            data: $('form').serialize(),
            success: function () {
                alert("Formulário enviado com sucesso!");
                $('form').trigger('reset');

                $('form input[type="submit"]').val('Enviar')
                    .attr('disabled', false);
            }
        });
    });
</script>
```

Para o *ajax* temos que passar um objeto javascript com as seguintes informações:

| Informação | Descrição |
| ---------- | --------- |
| type | Informamos qual o método |
| url | Informamos a url da requisição |
| data | Passamos os dados a serem submetidos, que são os campos do formulário |

Vejam que estamos passando as informações dinâmicamente, pegando os valores do formulário através dos seletores jQuery.

Depois de passar as informações corretas temos o evento de **success**, que é disparado caso tudo tenha processado corretamente, ou seja, se o email for enviado o *success* é executado.

Em nosso success mostramos uma mensagem para o usuário, utilizando o **alert**, e depois resetamos os campos do formulário.

Não podemos deixar de voltar o valor do botão para **Enviar** e habilitar novamente.

***

Desta forma estamos, de uma forma simples, melhorando o envio de email sem que o usuário seja direcionado para outra página.