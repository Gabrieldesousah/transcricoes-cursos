# Criando Model Category

Neste módulo começaremos modelar nossa aplicação.

Existe um arquivo, chamado **model.py**, dentro de **portal**, onde configuraremos todos os models necessários para a aplicação. A partir deste arquivo que serão geradas as tabelas, de banco de dados, e também teremos a ajuda, do ORM do Django, para buscas referentes a estas tabelas.

O primeiro passo será criar um model de categorias, que será chamado de **Category**. Todas as categorias dos produtos, que serão vendidos no Market Place, ficarão armazenadas nesta tabela.

O processo se resume em criar uma classe, que extente de uma outra classe do framework:

```python
from django.db import models


class Category(models.Model):
	name = models.CharField(max_length=255)
	slug = models.SlugField(unique=True)
	parent = models.ForeignKey('Category', null=True, blank=True, related_name='cat_child')
	order = models.IntegerField(null=True, blank=True)
	hidden = models.BooleanField(default=False)
```

Temos a classe **Category**, que extende de **models.Model**. Entenda melhor os campos:

| Campo | Descrição | Exemplo |
| ----- | --------- | ------- |
| name | Nome da categoria | Carros de Luxo |
| slug | Se trata do nome da categoria, se caracteres especiais, letras minúsculas e sem espaços | carros-de-luxo |
| parent | Permite que exista uma subcategoria de Category, como | - |
| order | Permite forçar uma ordenação no banco de dados. Este campo é opcional | 0 |
| hidden | Permite criar categorias que são ocultas | true |

> Explicando especificações dos campos

| Especificação | Descrição |
| ------------- | --------- |
| max_length=255 | Tamanho máximo de caracteres | 
| unique=True | Informa que o campo deve ser único | 
| null=True | Permite que o campo seja nulo | 
| blank=True | Permite que o campo seja vazio | 
| related\_name='cat_child' | Um nome relacionado para identificar subcategoria em buscas, diferenciando da categoria pai que ela pertence | 
| default=False | Valor padrão false, para novos campos | 

Explicando melhor o campo **related_name** podemos dizer que, em uma busca, pode haver uma dificuldade em saber se a categoria é pai ou filha, este campo nos auxilia em diferenciar esta hierarquia e também o resultado dos itens relacionados.

Depois de criar o model temos que criar as migrações e para isso o **manage.py** também tem um comando:

`.\manage.py makemigrations`

O comando buscará todos os models e se encarregará de criar todas as tabelas que ainda não estiverem criadas.

```
Migrations for 'portal':
  portal/migrations/0001_initial.py
    - Create model Category
```

Este comando cria um arquivo, dentro da pasta **migrations**. O nome do arquivo depende da ordem em que é criado, neste caso, tivemos **0001_initial.py**. Veja o conteúdo deste arquivo:

```python
# -*- coding: utf-8 -*-
# Generated by Django 1.11.1 on 2017-06-01 20:04
from __future__ import unicode_literals

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Category',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('slug', models.SlugField(unique=True)),
                ('order', models.IntegerField(blank=True, null=True)),
                ('hidden', models.BooleanField(default=False)),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='cat_child', to='portal.Category')),
            ],
        ),
    ]
```

O arquivo gerado tem todas as informações necessárias para que o comando **migrate** crie a tabela e os campos, com as configurações necessárias.

Então agora que temos o arquivo criado, precisamos rodar o comando **migrate** novamente.

`.\manage.py migrate`

```
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, portal, sessions
Running migrations:
  Applying portal.0001_initial... OK
```

Com estes passos já temos uma tabela e um modelo criado em nossa aplicação.

No próximo módulo, apenas por motivos de didática, criaremos uma area administrativa para gerenciamente deste model. Faremos este procedimento porque utilizaremos, em boa parte da administração do Market Place, a própria administração do Django. Somente a administração do vendedor será feita pela própria interface, utilizando nosso próprio layout.