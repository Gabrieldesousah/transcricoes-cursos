# Finalizando processo de login

Agora que já temos o processo de registro completo, temos que um outro ponto que gostaríamos de mostrar, que é como faremos o processo de login no sistema.

Ao invés de ficarmos desenvolvendo tudo do zero, o Django nos disponibiliza este processo pronto. E é fácil sabermos disso, porque nós conseguimos fazer o login, com nosso super admin, normalmente, sem ter desenvolvido absolutamente nada. Então utilizaremos este recurso pronto que o framework já possui.

Vá até o arquivo **login/urls.py** e faça as seguintes alterações:

```python
from django.conf.urls import url

from . import views
from django.contrib.auth import as auth_views

urlpatterns = [
    url(r'^register/success$', views.register_success, name='login_register_success'),
    url(r'^register$', views.register, name='login_register'),
    url(r'^login', auth_views.login, name='login'),
]
```

Percebam que adicionamos o caractere **$**, na frente das urls, para melhorar a expressão regular das nossas rotas.

Vejam que estamos importanto a classe **auth_views** e utilizando o método **login**, que já existe no Django. Este método utiliza um carregamento de template, que também já existe no Django. O nome do template que o processo carrega é **registration/login.html**.

Então a ideia é que criemos um arquivo com o mesmo nome, dentra da pasta com o mesmo nome, que já criamos pensando neste ponto do processo. Então como já temos a pasta registration criada, basta criarmos o arquivo **login.html**.

```html
{% extends 'base.html' %}

{% block title %}Login - Market Place{% endblock %}

{% block content %}
    <h3>Login</h3>

    <hr>

    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Login">
    </form>
{% endblock %}
```

Adicionando este código no arquivo juntamente com a rota configurada, já teremos o processo de login sendo renderizado, basta acessar a rota **http://127.0.0.1:8000/login**.

Percebam que removemos a action, do formulário, porque não é mais necessário.

### Logout

Outro processo que é importante na aplicação é o logout, que também aproveitaremos do Django.

Faremos o mesmo processo de login, adicionando uma rota ao arquivo **login/urls.py**.

```python
urlpatterns = [
    url(r'^register/success$', views.register_success, name='login_register_success'),
    url(r'^register$', views.register, name='login_register'),
    url(r'^login/$', auth_views.login, name='login'),
    url(r'^logout/$', auth_views.logout, {'next_page':'/'}, name='logout'),
]
```

Adicionamos a url **logout/**, que aponta para o método **logout**, do Django, e estamos passando um parâmentro chamado **next_page**, para saber para onde o usuário será redirecionado após o login, uma vez que não teremos uma template para este processo. Isso quer dizer que ao realizar o logout ele será redirecionado para a página inicial.

Para ficar um processo mais completo, no template da home, que está no arquivo **portal/templates/portal/home.html**, faremos uma alteração para que o usuário fique dinâmico e não mais manual, como está agora em nosso exemplo. Ao fazer o login você enxergará o usuário logodo e ao fazer o logout, ao ser redirecionado para a home, verá que não existe mais o usuário.

```html
{% extends 'base.html' %}

{% block title %}Home - Market Place{% endblock %}

{% block content %}
    <h3>Seja bem-vindo {{ request.user }}</h3>
{% endblock %}
```

Vejam que estamos chamando **request.user**, mas o método que estamos utilizando, para renderizar o template, não envia a request para a renderização. Portanto teremos que modificar de **render_to_response** para o método **render**, onde podemos passar a request para o template.

```html
from django.shortcuts import render, render_to_response


def home(request):
    return render(request, 'portal/home.html', {})
```

Desta forma estamos renderizando o mesmo template, porém com a request junto, podendo acessar os dados do usuário logado e imprimir o username.

### Conclusão

Já temos o processo de login, logout, registro de usuário e os templates já estão funcionando.

Nos próximos módulos começaremos trabalhar com areas administrativas, anunciar produto, criar a página de exibição de produto, criar a página de compra do produto e finalização de compra com integração de pagamento. Desta forma teremos a ideia principal do nosso Market Place.