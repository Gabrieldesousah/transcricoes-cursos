# Configurando S3Direct para upload de imagens

Esta parte do projeto é muito importante e foi deixada para o final exatamente por este motivo.

O gerenciamento de imagens será feito utilizando o serviço da **amazon**, que se chama **Amazon S3**. A amazon possui diversas soluções web e esta é uma de suas soluções.

Para conseguir fazer upload de imagens é necessário que façamos a aplicação se comunicar com os servidores da amazon.

Para conseguir concluir o projeto, será necessário criar uma conta na amazon. Existe um conta sem custo, então não se preocupe.

Existe um pacote, chamado **django-s3direct**, que auxilia no upload de arquivos para a amazon s3. Para instalar a biblioteca rode o comando abaixo no terminal:

```sh
pip3 install django-s3direct
```

Após instalação, como todas as outras bibliotecas e pacotes, registre no arquivo **/mktplace/settings.py**, para que ele possa ser carregado junto com a aplicação.

```python
# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'ajax_select',
    'algoliasearch_django',
    's3direct',
    'billing',
    'portal',
    'login',
]
```

Foi registrado como **s3direct**, como pode ver na listagem acima.

O próximo passo será passar algumas informações para a biblioteca, para que ela possa funcionar corretamente. Vejam as informações abaixo:

1. AWS_ACCESS_KEY_ID
2. AWS_SECRET_ACCESS_KEY
3. AWS_STORAGE_BUCKET_NAME
4. S3DIRECT_REGION
5. S3DIRECT_DESTINATIONS

Adicione, as constantes acima, em seu arquivo **settings.py**, logo abaixo das constantes do iugu.

```sh
AWS_ACCESS_KEY_ID = ''
AWS_SECRET_ACCESS_KEY = ''
AWS_STORAGE_BUCKET_NAME = ''
S3DIRECT_REGION = 'sa-east-1' # Região de São Paulo tem este valor como configuração, podendo mudar de acordo com a região do bucket

S3DIRECT_DESTINATIONS = {
    'product_images': {
        'key': 'uploads/images',
        'auth': lambda u: u.is_authenticated(), # Default allow anybody to upload
        'allowed': ['image/jpeg', 'image/png'],  # Default allow all mime types
    }
}
```

Você deverá preenche-las com os dados da sua conta da amazon. Caso tenha dúvida de como criar o serviço e como resgatar os dados, a **School of Net** dispobiniliza conteúdos específicos sobre amazon, para que você possa tirar suas dúvidas. O foco deste projeto é o Django então não serão abordados estes detalhes.

A constante **S3DIRECT_DESTINATIONS** é muito importante porque ela contem todas as informações referentes aos uploads. Nestas configurações podemos definir quem poderá subir arquivos, quais tipos de arquivos serão permitidos e difinir que o usuário deverá estar logado para fazer o upload.

A propriedade **product_images** representa o nome do local para onde os arquivos serão enviados. No momento pode parecer estranho pra você, mas entenderá no decorrer do desenvolvimento. Poder trabalhar com um objeto de **destinations** diferentes implica em poder enviar arquivos diferentes para locais diferentes e também podendo haver restrições diferentes.

No link abaixo você pode encontrar mais informações que são opcionais e que não utilizaremos em nosso projeto.

<https://github.com/bradleyg/django-s3direct>

Depois de todas estas configurações criadas partiremos para a criação dos models.