# Front-end - Listando avaliações

Neste módulo faremos todos os ajustes necessários para fazer a listagem de avaliações funcionar, uma vez que vocês já conhecem a estrutura inicial.

Abra o arquivo **/resources/assets/spa/js/store/teacher.js**. Certifique-se que você exportou o mini armazem, para que você possa utilizá-lo, caso contrário não conseguirá executar as consultas.

```js
import classInformation from './teacher/class_information';
import classTeaching from './teacher/class_teaching';
import classTest from './teacher/class_test';

const module = {
    namespaced: true,
    modules: {
        classInformation, classTeaching, classTest
    }
}

export default module;
```

A segunda alteração que você deve fazer é criar o método **mounted**, que acionará a action **query** que alimentará o armazem com as avaliações. Desta forma você já deverá ter as avaliações sendo listadas, porém sem algumas informações ainda.

Abra o arquivo **/resources/assets/spa/js/components/teacher/class_test/TeacherClassTestList.vue**.

```html
<script type="text/javascript">
    import store from '../../../store/store';

    export default {
        computed: {
            classTestis() {
                return store.state.teacher.classTest.classTests;
            }
        },
        mounted() {
            let classTeachingId = this.$route.params.class_teaching;
            store.dispatch('teacher/classTest/query', classTeachingId);
        },
        methods: {

        }
    }
</script>
```

Desta forma você terá todas as avaliações listadas, porém com alguns dados faltantes.

Caso queira verificar os resultados que estão vindo na consulta você pode abrir o developer tools e ir até a aba Network. Acessando a requisição você terá os resultados que estão vindo.

Depois de ver os dados sendo listados precisamos formatar o resultado serializado, adicionando alguns itens como: contagem de questões e total de pontuação.

Para alterar o resultado temos que alterar o método **toArray**, no model, portanto abra o model **/app/Models/ClassTest.php**.

```php
public function toArray()
{
    $data = parent::toArray();
    $data['date_start'] = (new Carbon($this->date_start))->format('Y-m-d\TH:i');
    $data['date_end'] = (new Carbon($this->date_end))->format('Y-m-d\TH:i');
    $data['total_questions'] = $this->questions()->getQuery()->count();
    $data['total_points'] = $this->questions()->getQuery()->sum('point');
    //$data['questions'] = $this->questions;
    return $data;
}
```

Vejam que estamos alterando o formato da data utilizando o biblioteca Carbon, do Laravel. Poderíamos utilizar o **Datetime**, porém o formato incluiria os segundos e não precisamos dos mesmos.

Depois estamos fazendo uma contagem de resultados de questões diretamente, utilizando o método **getQuery** seguido de **count**. Desta forma não precisamos fazer um select em todos os resultados e depois contar na programação, pois já teremos o resposta da contagem diretamente com o comando SQL.

O mesmo se faz com a soma das pontuações, porém utilizamos o método **sum**, passando a coluna que queremos somar.

Desta forma temos o número de questões e também o total da pontuação, da avaliação, sendo mostrados na listagem.