# Config e Service

Para melhorar ainda mais nosso código e separar responsabilidades, vamos criar mais dois arquivos em nossa estrutura. Nosso arquivo index ficará muito pequeno e teremos as mesmas funcionalidades.

Primeiro duplique a pasta do módulo anterior e renomeie para **code_08_config_and_service**.

Depois crie os arquivos abaixo:

1. **/code_08_config_and_service/public/config.php**
2. **/code_08_config_and_service/public/service.php**

O código do arquivo config.php ficará da seguinte maneira.

```php
use Pimple\Container;

$container = new Container();

$container['dsn'] = "mysql:host=localhost;dbname=test_oo";
$container['user'] = "root";
$container['pass'] = "";
```

Percebam que estamos iniciando a biblioteca Pimple no arquivo config e também estamos definindo os dados de conexão como se fossem serviços, desta forma conseguiremos abstrair ainda mais nosso código.

O código do arquivo service.php ficará da seguinte maneira.

```php
$container['conn'] = function ($c) {
    return new \Source\Conn($c['dsn'],$c['user'],$c['pass']);
};

$container['product'] = function ($c) {
    return new \Source\Product($c['conn']);
};
```

Percebam que no arquivo service temos todos os serviços, que antes eram registrados no arquivo index.

Vejam também que estamos passando os dados de conexão, no serviço **conn**, utiliando os serviços que registramos no arquivo config, com os dados de conexão. Não estamos mais passando os dados manualmente.

Agora que fizemos estas duas alteração precisamos remover o código do arquivo index e substituir pela chamada dos dois novos arquivos.

Abra o arquivo **/code_08_config_and_service/public/index.php**.

```php
require_once "../vendor/autoload.php";
require_once "config.php";
require_once "service.php";

$list = $container['product']->list();

var_dump($list);
```

Desta forma estamos com um arquivo muito menor e muito mais organizado, porém com a mesma funcionalidade.

No próximo módulo melhoraremos a classe **Product** e criaremos uma outra classe, chamada **ServiceProduct**, para listagem, criação, edição e exclusão de produtos. Desta forma estaremos separando responsabilidades.