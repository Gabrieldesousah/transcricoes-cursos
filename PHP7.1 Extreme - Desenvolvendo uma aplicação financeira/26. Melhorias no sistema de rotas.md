# Melhorias no sistema de rotas

Agora que já temos o sistema de rotas funcionando, vamos incrementar esta estrutura, precisamos fazer algumas melhorias.

A primeira melhoria será criar uma lógica para mostrar uma mensagem caso a rota acessada não exista. Porque até o momento não estamos tratando este possível erro.

```php
public function start(){
    $route = $this->service('route');

    if(!$route){
        echo "Page not found";
        exit;
    }

    $callable = $route->handler;
    $callable();
}
```

A segunda melhoria será passar a requisição, que foi criada pelo método **getRequest**, utilizando a biblioteca **zend-diactoros**, para o método start. Porque podemos querer resgatar algum dado, que foi enviado junto com a requisição. Podemos querer pegar algum parâmetro que foi passado na URL também.


```php
$app->get('/home/{name}/{id}', function(ServerRequestInterface $request){

});
```

Só tomem cuidado porque temos dois tipos de RequestInterface para ser utilizada. Existe a RequestInterface e ServerRequestInterface. Nós utilizaremos a ServerRequestInterface porque esta request nos permite receber dados que foram passados para o servidor.

Para receber os dados da requisição, no método start, faremos da seguinte forma.

```php
public function start(){
    $route = $this->service('route');
    /** @var ServerRequestInterface $request */
    $request = $this->service(RequestInterface::class);

    if(!$route){
        echo "Page not found";
        exit;
    }

    foreach ($route->attributes as $key => $value){
        $request = $request->withAttribute($key,$value);
    }

    $callable = $route->handler;
    $callable($request);
}
```

Primeiro atribuímos os dados da requisição para uma variável chamada $request. Vejam que diferenciamos no PHPDoc que estamos falando da **ServerRequestInterface**. Depois fizemos um foreach para passar por todos os parâmetros presentes na URL e, por fim, nós passamos para a variável **$callable**, que retorna para a nossa rota e nos permite recuperar o valor e imprimir na tela, quando acessamos determinada rota.

Veja um exemplo:

```php
$app->get('/home/{name}/{id}', function(ServerRequestInterface $request){
    echo "Mostrando a home!!";
    echo $request->getAttribute("name");
    echo "<br>";
    echo $request->getAttribute("id");
    echo "<br>";
});
```

Percebam que para passar parâmetros na URL basta adicionar o identificado do parâmetro utilizando **{}**. E como fizemos a tratativa no método **start**, podemos restagar utilizando **$request->getAttribute("name");**. Vejam que dentro do método passamos o identificador do parâmetro e assim teremos o resgate dos dados para pode utilizar.

Agora já temos o nosso sistema de rotas funcionando com passagem de parâmetros.