# Implementando container

Vamos começar a implementar o nosso container de serviços, mas antes vamos entender esta implementação. Poderíamos fazer a implementação manualmente, sem utilizar nenhuma biblioteca, mas precisamos ver no PHP-FIG se existe alguma biblioteca que nos ajuda e fazer esta implementação ou se existe algum padrão.

E na verdade nós já temos uma recomendação para trabalhar com estes containers. <http://www.php-fig.org/psr/#review>

Antigamente os frameworks trabalhavam com containers, porém cada um implementavam de uma maneira diferente. Mas se quiséssemos fazer uma integração entre os containers ou se quiséssemos apenas trocar um container de serviço por outro, era uma tarefa muit complicada, porque cada um era implementado de uma forma.

O objetivo da PSR é criar a interoperabilidade e por isso que criou um padrão de implementação. A intenção é que futuramente todos os containers sejam implementados de uma forma apenas, assim você poderá trocar sempre que quiser.

Esta PSR para implementação de container está em revisão ainda, mas já podemos trabalhar com ela. Isso quer dizer que se eu instalar uma biblioteca que utiliza esta interface e posteriormente eu quiser implementar outra biblioteca que também utiliza eu não vou ter problema nenhum em trabalhar com as das bibliotecas simultaneamente em meu projeto, porque a forma de implementação é a mesma. Este é o objetivo desta PSR, no futuro termos um padrão fixado de implementação para containers.

O container da PSR consiste apenas em métodos para pegar um container e verificar a existência de determinados containers, ou seja, apenas dois métodos. Isso quer dizer que a PSR não está preocupada como foi criado o container, apenas está querendo padronizar a implementação dos mesmos.

Nós utilizaremos o container de serviços chamado de **PIMPLE** que é produzido pelo menos pessoal que mantém o **Symfony Framework**. Se trata de um container muito simples onde a implementação é baseada em array e tem suporte a injeção de dependência. Considere o Pimple se precisar desenvolver uma aplicação até de médio porte.

O Pimple ainda não trabalha com a PSR-11, por padrão, mas existe uma biblioteca que extende o Pimple e força que ele implemente esta PSR-11, para que estejamos de acordo com os padrões de desenvolvimento. O nosso objetivo, com este conteúdo, além da aplicação final, é mostrar os padrão e incentivar que você os utilize em seus projetos.

Então instalaremos a biblioteca que faz esta implementação via PSR-11.

`composer require xtreamwayz/pimple-container-interop`

Depois de instalada a biblioteca, vamos fazer a integração do nosso container de serviços. Crie um arquivo chamado **ServiceContainer.php**, dentro da pasta **src**.

```php
<?php

namespace SONFin;

use Xtreamwayz\Pimple\Container;

class ServiceContainer implements ServiceContainerInterface
{

    private $container;

    /**
     * ServiceContainer constructor.
     * @param $container
     */
    public function __construct()
    {
        $this->container = new Container();
    }

    public function add(string $name, $service)
    {
        $this->container[$name] = $service;
    }

    public function addLazy(string $name, callable $callable)
    {
        $this->container[$name] = $this->container->factory($callable);
    }

    public function get(string $name)
    {
        return $this->container->get($name);
    }

    public function has(string $name)
    {
        return $this->container->has($name);
    }
}
?>
```

Reparem que nosso **ServiceContainer** implementa a nossa interface **ServiceContainerInterface** e portanto deve implementar os métodos que ela obriga. Veja que no construtor nós instanciamos um container, que vem da biblioteca que instalamos anteriormente. Dentro dos métodos nós utilizamos o container para implementar os dois métodos da PSR-11, que é **get** e **has** e também os métodos add e addLazy.

Agora já estamos aptos a começar popular nosso container de serviços. Depois de gravar os serviços basta acessar de qualquer lugar da aplicação, assim como nós havíamos planejado.